@model CMSDiamondStay.Models.Apartments
@{
    ViewBag.Title = "CreateApartment";
}

<style>
    #map {
        width: 100%;
        height: 400px;
    }
</style>
<!-- page content -->

<div class="">
    <h3 style="text-align: center;">Vui lòng nhập thông tin căn hộ của bạn</h3>

    <div class="row">
        <!-- form input mask -->
        <div class="col-md-12 col-sm-12  ">
            <div class="x_panel">
                <div class="x_title">
                    <div class="clearfix"></div>
                </div>
                <div class="x_content">
                    <form class="" action="" id="data" method="post" enctype="multipart/form-data">
                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Tên căn hộ mới</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="name" id="name"
                                       placeholder="Vui lòng nhập tên căn hộ mới." required="required" />
                            </div>
                        </div>
                        <div class="field item form-group">
                            <label class="control-label col-md-3 col-sm-3 label-align">Chọn loại căn hộ</label>
                            <div class="col-md-6 col-sm-6 ">
                                <select class="form-control" id="apartment_type" name="apartment_type">
                                    <option value="1">Biệt thự</option>
                                    <option value="2">Studio</option>
                                    <option value="3">Chung cư</option>
                                    <option value="4">Nhà riêng</option>
                                    <option value="5">Home stay</option>
                                    <option value="6">Khách sạn</option>
                                </select>
                            </div>
                        </div>
                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Mô tả</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="description" id="description"
                                       placeholder="Mô tả căn hộ của bạn" required="required" />
                            </div>
                        </div>
                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Số Lượng Giường</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="amount_bed"
                                       placeholder="Số Lượng Giường (Chiếc)" required="required" id="amount_bed" />
                            </div>
                        </div>
                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Số Lượng Sofa</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="amount_sofa"
                                       placeholder="Số Lượng Giường (Chiếc)" required="required" id="amount_sofa" />
                            </div>
                        </div>
                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Sức chứa tiêu chuẩn</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="capacity_standard"
                                       placeholder="Số lượng người cùng ở tiêu chuẩn." required="required" id="capacity_standard" />
                            </div>
                        </div>
                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Sức chứa tối đa</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="capacity_max" id="capacity_max"
                                       placeholder="Số lượng người cùng ở tối đa." required="required" />
                            </div>
                        </div>
                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Nơi vui chơi giải trí đề xuất</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="relax_suggest" id="relax_suggest"
                                       placeholder="Đề xuất cho khách thuê một vài địa điểm vui choi." required="required" />
                            </div>
                        </div>
                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Hướng dẫn</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="direction_instruction" id="direction_instruction"
                                       placeholder="Hướng đẫn khách sử dụng căn hộ hiệu quả." required="required" />
                            </div>
                        </div>

                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Ấm thực</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="cuisine_suggest" id="cuisine_suggest"
                                       placeholder="Món ngon." required="required" />
                            </div>
                        </div>

                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Quy định căn hộ</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="regulation" id="regulation"
                                       placeholder="Quy tắc chung quản lý căn hộ." required="required" />
                            </div>
                        </div>
                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Số điện thoại liên hệ</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="phone" id="phone"
                                       placeholder="Số điện thoại liên hệ với chủ căn hộ." required="required" />
                            </div>
                        </div>
                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Fax</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="fax" id="fax"
                                       placeholder="Số Fax" required="required" />
                            </div>
                        </div>

                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Diện tích (mét vuông)</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="area" id="area"
                                       placeholder="Diện tích tính bằng (mét vuông)" required="required" />
                            </div>
                        </div>

                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Số lượng phòng tắm</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="amount_bathroom" id="amount_bathroom"
                                       placeholder="Có bao nhiêu phòng tắm trong căn hộ của bạn ?" required="required" />
                            </div>
                        </div>

                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Số lượng phòng ngủ</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="amount_bedroom" id="amount_bedroom"
                                       placeholder="Có bao nhiêu phòng ngủ trong căn hộ của bạn ?" required="required" />
                            </div>
                        </div>

                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Tiêu Chuẩn Sao</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="star_standard" id="star_standard"
                                       placeholder="Tiêu Chuẩn Sao" required="required" />
                            </div>
                        </div>



                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Các tiện ích</label>
                            <p style="padding: 5px;" class="col-md-6 col-sm-6 ">
                                @foreach (var convenience in ViewBag.convenience)
                                {
                                    <input id="@convenience.id" type="checkbox" name="conveniences" value="@convenience.id" class="flat" />
                                    <label for="@convenience.id" class="flat"> @convenience.name</label>
                                }
                            </p>


                        </div>

                        <div class="field item form-group">
                            <label class="control-label col-md-3 col-sm-3 label-align">Chính sách hủy</label>
                            <div class="col-md-6 col-sm-6 ">
                                <select class="form-control" id="cancel_policy" name="cancel_policy">
                                    <option value="0">Thường</option>
                                    <option value="1">Linh Hoạt</option>
                                    <option value="2">Nghiêm Ngặt</option>
                                </select>
                            </div>
                        </div>



                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Vị trí căn hộ</label>
                            <div class="col-md-6 col-sm-6">
                                <div>
                                    Travel From : <input id="travelfrom" type="text" name="travelfrom" value="Hà Nội, Việt Nam" />
                                    To : <input id="travelto" type="text" name="name" value="Bắc Ninh, Việt Nam" />
                                    <input type="button" value="Get Route" onclick="GetRoute()" />

                                </div>
                                <br />
                                <div>
                                    <div id="dvDistance">
                                    </div>
                                </div>
                                <button class="btn btn-primary" style="" onclick="timDuongDi()">Tìm đường đi</button>
                                <div id="map"></div>
                            </div>
                        </div>







                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Hình ảnh</label>
                            <div class="col-md-6 col-sm-6">
                                <input id="fileupload" type="file" name="fileupload" multiple="multiple" />
                                <hr />
                                <b>Live Preview</b>
                                <br />
                                <br />
                                <div id="dvPreview">
                                </div>
                            </div>
                        </div>

                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Giá Phòng</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="price" id="price"
                                       placeholder="Giá Phòng" required="required" />
                            </div>
                        </div>

                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Tăng giá</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="price_promotion" id="price_promotion"
                                       placeholder="Tăng giá" required="required" />
                            </div>
                        </div>


                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Phụ phí mỗi người</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="surcharge_per_person" id="surcharge_per_person"
                                       placeholder="Phụ phí mỗi người" required="required" />
                            </div>
                        </div>

                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Ngày tối thiểu</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="min_day" id="min_day"
                                       placeholder="Ngày tối thiểu" required="required" />
                            </div>
                        </div>

                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">Ngày tối đa</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="max_day" id="max_day"
                                       placeholder="Ngày tối đa" required="required" />
                            </div>
                        </div>



                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">check in time</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="check_in_time" id="check_in_time"
                                       placeholder="check in time" required="required" />
                            </div>
                        </div>

                        <div class="field item form-group">
                            <label class="col-form-label col-md-3 col-sm-3  label-align">check out time</label>
                            <div class="col-md-6 col-sm-6">
                                <input class="form-control" data-validate-length-range="255" data-validate-words="2" name="check_out_time" id="check_out_time"
                                       placeholder="check out time" required="required" />
                            </div>
                        </div>


                        <div class="ln_solid">
                            <div class="form-group">
                                <div class="col-md-6 offset-md-3">
                                    <button type='button' class="btn btn-primary" id="btnSave">Submit</button>
                                    <button type='reset' class="btn btn-success">Reset</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- /form input mask -->

    </div>
</div><!-- /.docs-toggles -->
@section scripts{


    <script>


        $(document).ready(function () {
            var lat, lng;
            var apartment_type = $('#apartment_type option:selected').val(); 
            var cancel_policy = $('#cancel_policy option:selected').val();
            var ckebox_value = $("input[name=conveniences]:checked").map(function () {
                if ($(this).val() != 0) {
                    return $(this).val();
                }
            }).get();
            //function will be called on button click having id btnsave
            $("#btnSave").click(function () {

                //var files = $("#fileupload").get(0).files;
                //var file_data = new FormData();

                //for (var i = 0; i < files.length; i++) {
                //    file_data.append("fileupload", files[i]);
                //}

                var form = $('#data')[0];

             
                var dataModel = new FormData(form);

                dataModel.append("conveniences", ckebox_value);
                dataModel.append("apartment_type", apartment_type);
                dataModel.append("cancel_policy", cancel_policy);
                dataModel.append("latitude", lat);
                dataModel.append("longitude", lng);

                $.ajax({
                    type: "POST",
                    enctype: 'multipart/form-data',
                    url: "/Home/Create",
                    data: dataModel,
                    contentType: false, // Not to set any content header
                    processData: false, // Not to process data
                    success: function (result, status, xhr) {
                        alert(result);
                    },
                    error: function (xhr, status, error) {
                        alert(status);
                    }
                });
                //$.ajax({
                //    type: "POST",
                //    url: "/Home/Create",
                //    //dataType: "json",
                //    contentType: false, // Not to set any content header
                //    processData: false, // Not to process data
                //    data: file_data,
                //    success: function (result, status, xhr) {
                //        alert(result);
                //    },
                //    error: function (xhr, status, error) {
                //        alert(status);
                //    }
                //});

            });
            google.maps.event.addListener(map, 'click', function (event) {
                placeMarker(map, event.latLng);
                lat = event.latLng.lat();
                lng = event.latLng.lng();
            });
        });

        //var apartment = new Object();
                //apartment.name = $("#name").val(); //Reading text box values using Jquery
                //apartment.amount_bed = $("#amount_bed").val();
                //apartment.amount_sofa = $("#amount_sofa").val();
                //apartment.capacity_standard = $("#capacity_standard").val();
                //apartment.capacity_max = $("#capacity_max").val();
                //apartment.relax_suggest = $("#relax_suggest").val();
                //apartment.direction_instruction = $("#direction_instruction").val();
                //apartment.cuisine_suggest = $("#cuisine_suggest").val();
                //apartment.regulation= $("#regulation").val();
                //apartment.phone = $("#phone").val();
                //apartment.fax = $("#fax").val();
                //apartment.area = $("#area").val();
                //apartment.amount_bathroom = $("#amount_bathroom").val();
                //apartment.amount_bedroom = $("#amount_bedroom").val();
                //apartment.star_standard = $("#star_standard").val();
                //apartment.conveniences = ckebox_value;
                //apartment.cancel_policy = cancel_policy;
                //apartment.latitude = lat;
                //apartment.longitude = lng;
                //apartment.travelfrom = $("#travelfrom").val();
                //apartment.apartment_type = apartment_type;
                //apartment.price = $("#price").val();
                //apartment.price_promotion = $("#price_promotion").val();
                //apartment.min_day = $("#min_day").val();
                //apartment.max_day = $("#max_day").val();
                //apartment.surcharge_per_person = $("#surcharge_per_person").val();
                //apartment.check_in_time = $("#check_in_time").val();
                //apartment.check_out_time = $("#check_in_time").val();

        //$("form#data").submit(function (e) {
        //    e.preventDefault();
        //    var formData = new FormData(this);

        //    $.ajax({
        //        url: window.location.pathname,
        //        type: 'POST',
        //        data: formData,
        //        success: function (data) {
        //            alert(data)
        //        },
        //        cache: false,
        //        contentType: false,
        //        processData: false
        //    });
        //});

    </script>
    <script type="text/javascript">
        window.onload = function () {
            var fileUpload = document.getElementById("fileupload");
            fileUpload.onchange = function () {
                if (typeof (FileReader) != "undefined") {
                    var dvPreview = document.getElementById("dvPreview");
                    dvPreview.innerHTML = "";
                    var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.jpg|.jpeg|.gif|.png|.bmp)$/;
                    for (var i = 0; i < fileUpload.files.length; i++) {
                        var file = fileUpload.files[i];
                        if (regex.test(file.name.toLowerCase())) {
                            var reader = new FileReader();
                            reader.onload = function (e) {
                                var img = document.createElement("IMG");
                                img.height = "100";
                                img.width = "100";
                                img.src = e.target.result;
                                dvPreview.appendChild(img);
                            }
                            reader.readAsDataURL(file);
                        } else {
                            alert(file.name + " is not a valid image file.");
                            dvPreview.innerHTML = "";
                            return false;
                        }
                    }
                } else {
                    alert("This browser does not support HTML5 FileReader.");
                }
            }
        };
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyAWX9wvYc5A0RwrT_pMQfV9uw_YxIela_0" type="text/javascript"></script>

    <script>
        var source, destination;
        var directionsDisplay;
        var lat, lng;
        var directionsService = new google.maps.DirectionsService();
        var latlng = new google.maps.LatLng(21.028529, 105.782162);
        // initialise the location of the map on Chichester in England (ref lat and lng)
        var map = new google.maps.Map(document.getElementById('map'), {
            center: latlng,
            zoom: 13,
            mapTypeId: 'roadmap'
        });

        google.maps.event.addDomListener(window, 'load', function () {
            new google.maps.places.SearchBox(document.getElementById('travelfrom'));
            new google.maps.places.SearchBox(document.getElementById('travelto'));
            directionsDisplay = new google.maps.DirectionsRenderer({ 'draggable': true });
        });

        google.maps.event.addListener(map, 'click', function (event) {
            placeMarker(map, event.latLng);
            lat = event.latLng.lat();
            lng = event.latLng.lng();
        });

        function placeMarker(map, location) {
            var marker = new google.maps.Marker({
                position: location,
                map: map
            });
            var infowindow = new google.maps.InfoWindow({
                content: 'Latitude: ' + location.lat() +
                    '<br>Longitude: ' + location.lng()
            });
            infowindow.open(map, marker);
        }

        function GetRoute() {

            directionsDisplay.setMap(map);

            source = document.getElementById("travelfrom").value;
            destination = document.getElementById("travelto").value;

            var request = {
                origin: source,
                destination: destination,
                travelMode: google.maps.TravelMode.DRIVING
            };

            directionsService.route(request, function (response, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setDirections(response);
                }
            });

            //*********DISTANCE AND DURATION**********************//
            var service = new google.maps.DistanceMatrixService();
            service.getDistanceMatrix({
                origins: [source],
                destinations: [destination],
                travelMode: google.maps.TravelMode.DRIVING,
                unitSystem: google.maps.UnitSystem.METRIC,
                avoidHighways: false,
                avoidTolls: false
            }, function (response, status) {

                if (status == google.maps.DistanceMatrixStatus.OK && response.rows[0].elements[0].status != "ZERO_RESULTS") {
                    var distance = response.rows[0].elements[0].distance.text;
                    var duration = response.rows[0].elements[0].duration.value;
                    var dvDistance = document.getElementById("dvDistance");
                    duration = parseFloat(duration / 60).toFixed(2);
                    dvDistance.innerHTML = "";
                    dvDistance.innerHTML += "Distance: " + distance + "<br />";
                    dvDistance.innerHTML += "Time:" + duration + " min";

                } else {
                    alert("Unable to find the distance via road.");
                }
            });
        }


        function timDuongDi() {
            var latlng = new google.maps.LatLng(lat, lng); //Vị trí của cửa hàng
            var map = new google.maps.Map(document.getElementById('map'), {
                center: latlng,
                zoom: 16
            });
            var infoWindow = new google.maps.InfoWindow({ map: map });

            // Try HTML5 geolocation.
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    infoWindow.setPosition(pos);
                    infoWindow.setContent('Vị trí của bạn');
                    map.setCenter(pos);

                    var directionsDisplay = new google.maps.DirectionsRenderer({
                        map: map
                    });
                    var request = {
                        destination: latlng,
                        origin: pos,
                        travelMode: google.maps.TravelMode.DRIVING
                    };
                    var directionsService = new google.maps.DirectionsService();
                    directionsService.route(request, function (response, status) {
                        if (status == google.maps.DirectionsStatus.OK) {
                            // Display the route on the map.
                            directionsDisplay.setDirections(response);
                        }
                    });
                }, function () {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }
        }
        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
        }


    </script>
}
